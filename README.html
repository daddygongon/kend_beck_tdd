<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="jp" xml:lang="jp">
<head>
<!-- 2023-07-15 Sat 15:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kent Beck's TDD example by Ruby</title>
<meta name="author" content="Shigeto R. Nishitani" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Kent Beck's TDD example by Ruby</h1>

<div id="outline-container-org80c31eb" class="outline-2">
<h2 id="org80c31eb"><span class="section-number-2">1.</span> c4 :: Privacy</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> $5 + 10CHF = $10 (if rate is 2:1)</li>
<li class="on"><code>[X]</code> $5 * 2 = $10</li>
<li class="on"><code>[X]</code> Make "amount" private(protected)</li>
<li class="on"><code>[X]</code> Dollar side-effects?</li>
<li class="off"><code>[&#xa0;]</code> Money rounding?</li>
<li class="on"><code>[X]</code> equals()</li>
<li class="off"><code>[&#xa0;]</code> equal null</li>
<li class="off"><code>[&#xa0;]</code> Equal object</li>
<li class="off"><code>[&#xa0;]</code> hashCode()</li>

<li class="off"><code>[&#xa0;]</code> <p>
疑問1
c4の最初のtest変更はobject同士の比較となる．
</p>
<pre class="example">
assert_equal(Dollar.new(10), product)
</pre>

<p>
javaのassertEqualsのpropertyと思われるが，
assertEqualsが最初の引数のequals関数を呼び出しているものと
思われる．
Rubyでこれを実装するのは難しそう．なので，
</p>
<pre class="example">
assert_true(Dollar.new(10).equals(product))
</pre>

<p>
と書き換える．Dollarの実装はそのまま．
</p></li>

<li class="off"><code>[&#xa0;]</code> 疑問2
「@amountをprivateにする」という説明があるが，
これを失敗する．
equals method内でdollar.amountを使っているから．
この辺り，JavaのprivateとRubyのprivateの違いかも．
ここをRubyではprotectedにしている．
Rubyのprotected, private, public宣言は3.0からなので
注意が必要かも．</li>
</ul>

<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #1c86ee;">class</span> <span style="color: #00688b;">Dollar</span>
  <span style="color: #cd6600;">protected</span> <span style="color: #cd6600;">attr_reader</span> <span style="color: #6e8b3d;">:amount</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ruby">test <span style="color: #8b7355;">"multiplication"</span> <span style="color: #1c86ee;">do</span>
  five = <span style="color: #00688b;">Dollar</span>.new(5)

  <span style="color: #7f7f7f;">#    </span><span style="color: #7f7f7f;">assert_equal(Dollar.new(10), product)</span>
  assert_true(<span style="color: #00688b;">Dollar</span>.new(10).equals(five.times(2)))
  assert_true(<span style="color: #00688b;">Dollar</span>.new(15).equals(five.times(3)))
<span style="color: #1c86ee;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgab7ff94" class="outline-2">
<h2 id="orgab7ff94"><span class="section-number-2">2.</span> c3 :: Equality for All</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> $5 + 10CHF = $10 (if rate is 2:1)</li>
<li class="on"><code>[X]</code> $5 * 2 = $10</li>
<li class="off"><code>[&#xa0;]</code> Make "amount" private</li>
<li class="on"><code>[X]</code> Dollar side-effects?</li>
<li class="off"><code>[&#xa0;]</code> Money rounding?</li>
<li class="on"><code>[X]</code> equals()</li>
<li class="off"><code>[&#xa0;]</code> hashCode()</li>
</ul>

<div class="org-src-container">
<pre class="src src-ruby">test <span style="color: #8b7355;">"equality"</span> <span style="color: #1c86ee;">do</span>
  assert_true(<span style="color: #00688b;">Dollar</span>.new(5).equals(<span style="color: #00688b;">Dollar</span>.new(5)))
  assert_false(<span style="color: #00688b;">Dollar</span>.new(5).equals(<span style="color: #00688b;">Dollar</span>.new(6)))
<span style="color: #1c86ee;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #1c86ee;">def</span> <span style="color: #cd9b1d;">equals</span>(object)
  dollar = object
  <span style="color: #1c86ee;">return</span> <span style="color: #2e8b57;">@amount</span> == dollar.amount
<span style="color: #1c86ee;">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2d5de3" class="outline-2">
<h2 id="orgb2d5de3"><span class="section-number-2">3.</span> c2 :: Degenerate Objects</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> $5 + 10CHF = $10 (if rate is 2:1)</li>
<li class="on"><code>[X]</code> $5 * 2 = $10</li>
<li class="off"><code>[&#xa0;]</code> Make "amount" private</li>
<li class="off"><code>[&#xa0;]</code> Dollar side-effects?</li>
<li class="off"><code>[&#xa0;]</code> Money rounding?</li>

<li class="off"><code>[&#xa0;]</code> 疑問
product = Dollar.new(five.times(2))となるはずだが，error
が出るんで，product = five.times(2)と修正．timesがDollarを
返してるんで．．．</li>
</ul>


<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">frozen_string_literal: true</span>
<span style="color: #cd6600;">require</span> <span style="color: #8b7355;">"test_helper"</span>
<span style="color: #1c86ee;">class</span> <span style="color: #00688b;">TddExample2Test</span> &lt; <span style="color: #00688b;">Test</span>::<span style="color: #00688b;">Unit</span>::<span style="color: #00688b;">TestCase</span>
  <span style="color: #cd6600;">include</span> <span style="color: #00688b;">TddExample2</span>
  test <span style="color: #8b7355;">"multiplication"</span> <span style="color: #1c86ee;">do</span>
    five = <span style="color: #00688b;">Dollar</span>.new(5)
    product = five.times(2)
    assert_equal(10, product.amount)
    product = five.times(3)
    assert_equal(15, product.amount)
  <span style="color: #1c86ee;">end</span>
<span style="color: #1c86ee;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">frozen_string_literal: true</span>

<span style="color: #cd6600;">require_relative</span> <span style="color: #8b7355;">"tdd_example2/version"</span>

<span style="color: #1c86ee;">module</span> <span style="color: #00688b;">TddExample2</span>
  <span style="color: #1c86ee;">class</span> <span style="color: #00688b;">Error</span> &lt; <span style="color: #00688b;">StandardError</span>; <span style="color: #1c86ee;">end</span>
  <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Your code goes here...</span>
  <span style="color: #1c86ee;">class</span> <span style="color: #00688b;">Dollar</span>
    <span style="color: #cd6600;">attr_reader</span> <span style="color: #6e8b3d;">:amount</span>
    <span style="color: #1c86ee;">def</span> <span style="color: #cd9b1d;">initialize</span>(amount)
      <span style="color: #2e8b57;">@amount</span> = amount
    <span style="color: #1c86ee;">end</span>
    <span style="color: #1c86ee;">def</span> <span style="color: #cd9b1d;">times</span>(multiplier)
      <span style="color: #1c86ee;">return</span> <span style="color: #00688b;">Dollar</span>.new(<span style="color: #2e8b57;">@amount</span> * multiplier)
    <span style="color: #1c86ee;">end</span>
  <span style="color: #1c86ee;">end</span>
<span style="color: #1c86ee;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org3001f0e" class="outline-2">
<h2 id="org3001f0e"><span class="section-number-2">4.</span> c1 :: Multi-Currency Money</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> $5 + 10CHF = $10 (if rate is 2:1)</li>
<li class="off"><code>[&#xa0;]</code> $5 * 2 = $10
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Make "amount" private</li>
<li class="off"><code>[&#xa0;]</code> Dollar side-effects?</li>
<li class="off"><code>[&#xa0;]</code> Money rounding?</li>
</ul></li>
</ul>
<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">frozen_string_literal: true</span>

<span style="color: #cd6600;">require</span> <span style="color: #8b7355;">"test_helper"</span>

<span style="color: #1c86ee;">class</span> <span style="color: #00688b;">TddExample2Test</span> &lt; <span style="color: #00688b;">Test</span>::<span style="color: #00688b;">Unit</span>::<span style="color: #00688b;">TestCase</span>
  <span style="color: #cd6600;">include</span> <span style="color: #00688b;">TddExample2</span>
  test <span style="color: #8b7355;">"VERSION"</span> <span style="color: #1c86ee;">do</span>
    assert <span style="color: #1c86ee;">do</span>
      ::<span style="color: #00688b;">TddExample2</span>.const_defined?(<span style="color: #6e8b3d;">:VERSION</span>)
    <span style="color: #1c86ee;">end</span>
  <span style="color: #1c86ee;">end</span>

  test <span style="color: #8b7355;">"multiplication"</span> <span style="color: #1c86ee;">do</span>
    five = <span style="color: #00688b;">Dollar</span>.new(5)
    five.times(2)
    assert_equal(10, five.amount)
  <span style="color: #1c86ee;">end</span>
<span style="color: #1c86ee;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">frozen_string_literal: true</span>

<span style="color: #cd6600;">require_relative</span> <span style="color: #8b7355;">"tdd_example2/version"</span>

<span style="color: #1c86ee;">module</span> <span style="color: #00688b;">TddExample2</span>
  <span style="color: #1c86ee;">class</span> <span style="color: #00688b;">Error</span> &lt; <span style="color: #00688b;">StandardError</span>; <span style="color: #1c86ee;">end</span>
  <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">Your code goes here...</span>
  <span style="color: #1c86ee;">class</span> <span style="color: #00688b;">Dollar</span>
    <span style="color: #cd6600;">attr_reader</span> <span style="color: #6e8b3d;">:amount</span>
    <span style="color: #1c86ee;">def</span> <span style="color: #cd9b1d;">initialize</span>(amount)
      <span style="color: #2e8b57;">@amount</span> = amount
    <span style="color: #1c86ee;">end</span>
    <span style="color: #1c86ee;">def</span> <span style="color: #cd9b1d;">times</span>(multiplier)
      <span style="color: #2e8b57;">@amount</span> *= multiplier
    <span style="color: #1c86ee;">end</span>
  <span style="color: #1c86ee;">end</span>
<span style="color: #1c86ee;">end</span>
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Shigeto R. Nishitani</p>
<p class="date">Created: 2023-07-15 Sat 15:33</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
